import GUEST_SRC from "../../assets/guest.png";

export let topPlayers = [
  {
    username: "Bartosz Moszczyński",
    message: "łatwa gierka ez",
    imgURL:
      "https://scontent-waw1-1.xx.fbcdn.net/v/t39.30808-6/348638404_561194402880530_1313259155838271113_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=09cbfe&_nc_ohc=N2mRFPqX2Z8AX_aw-pc&_nc_ht=scontent-waw1-1.xx&oh=00_AfCIOZlcgacsw3yuNse3mZXh1hHzTfZeXgUvCZep4TQIOQ&oe=6487F664",
    statistics: {
      points: 68400,
      speed: 1,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 2,
        seconds: 36,
      },
    },
    published: {
      year: 2023,
      month: 5,
      day: 1,
    },
  },
  {
    username: "Bartosz Moszczyński",
    message: "hihihiha",
    imgURL:
      "https://scontent-waw1-1.xx.fbcdn.net/v/t39.30808-6/348638404_561194402880530_1313259155838271113_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=09cbfe&_nc_ohc=N2mRFPqX2Z8AX_aw-pc&_nc_ht=scontent-waw1-1.xx&oh=00_AfCIOZlcgacsw3yuNse3mZXh1hHzTfZeXgUvCZep4TQIOQ&oe=6487F664",
    statistics: {
      points: 65400,
      speed: 3,
      boardSize: 40,
      length: 60,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 4,
      day: 29,
    },
  },
  {
    username: "Bartosz Moszczyński",
    message: "huehuehuehuehuehuehuehhuehuehuehuehueheuheuheuheu",
    imgURL: "",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 5,
      day: 2,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 6,
      day: 8,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 5,
      day: 28,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 5,
      day: 20,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 5,
      day: 30,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 9,
      day: 6,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 6,
      day: 9,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 6,
      day: 4,
    },
  },
  {
    username: "Hu Tao",
    message:
      '"Hu" as in: "Who put me in this coffin?", and Tao as in: "I cant get TAOt!" :D',
    imgURL: "https://wallpapercave.com/wp/wp11693252.jpg",
    statistics: {
      points: 62400,
      speed: 2,
      boardSize: 20,
      length: 40,
      time: {
        hours: 0,
        minutes: 3,
        seconds: 24,
      },
    },
    published: {
      year: 2023,
      month: 6,
      day: 2,
    },
  },
];

const leaderboardTop = document.querySelector(".leaderboard-top");

const handleCreateElement = (index, record) => {
  const { username, message, imgURL: profile_src, statistics } = record;
  const { time } = statistics;
  const { hours, minutes, seconds } = time;
  const { points, speed, boardSize } = statistics;

  const leaderboardRecord = document.createElement("div");
  leaderboardRecord.classList.add("leaderboard-record");
  const recordTrophy = document.createElement("div");
  recordTrophy.classList.add("leaderboard-record-trophy");
  const trophy = document.createElement("img");
  trophy.classList.add("leaderboard-trophy-img");
  const playerPos = document.createElement("div");
  playerPos.classList.add("leaderboard-position");
  const leaderboardInfo = document.createElement("div");
  leaderboardInfo.classList.add("leaderboard-info");
  const leaderboardProfile = document.createElement("div");
  leaderboardProfile.classList.add("leaderboard-profile");
  const leaderboardProfileImg = document.createElement("img");
  leaderboardProfileImg.classList.add("leaderboard-profile-img");
  const leaderboardUsername = document.createElement("div");
  leaderboardUsername.classList.add("leaderboard-username");
  const leaderboardMessage = document.createElement("div");
  leaderboardMessage.classList.add("leaderboard-message");
  const leaderboardMessageIcon = document.createElement("i");
  leaderboardMessageIcon.classList.add("fa-regular");
  leaderboardMessageIcon.classList.add("fa-message");
  const leaderboardMessageContent = document.createElement("h5");
  leaderboardMessageContent.classList.add("leaderboard-message-content");
  const leaderboardStatistics = document.createElement("div");
  leaderboardStatistics.classList.add("leaderboard-statistics");
  const leaderboardStatisticsArr = [];

  const statisticIcons = [
    "fa-solid fa-star statistic-icon",
    "fa-solid fa-gauge-high statistic-icon",
    "fa-solid fa-maximize statistic-icon",
    "fa-solid fa-clock statistic-icon",
  ];

  for (let i = 0; i < 4; i++) {
    const leaderboardStatistic = document.createElement("div");
    leaderboardStatistic.classList.add("leaderboard-statistic");
    const statisticIcon = document.createElement("i");
    const statisticIconClasses = [...statisticIcons[i].split(" ")];
    statisticIconClasses.map((className) => {
      statisticIcon.classList.add(className);
    });
    const statisticSpan = document.createElement("span");

    switch (i) {
      case 0:
        statisticSpan.textContent = points;
        break;
      case 1:
        statisticSpan.textContent = speed.toFixed(2);
        break;
      case 2:
        statisticSpan.textContent = boardSize;
        break;
      case 3:
        statisticSpan.textContent = `${hours > 10 ? hours : "0" + hours}:${
          minutes > 10 ? minutes : "0" + minutes
        }:${seconds > 10 ? seconds : "0" + payload.time.seconds}`;
        break;
    }

    statisticSpan.classList.add("statistic-span");

    leaderboardStatistic.appendChild(statisticIcon);
    leaderboardStatistic.appendChild(statisticSpan);

    leaderboardStatisticsArr.push(leaderboardStatistic);
  }

  leaderboardUsername.textContent = username;
  if (message !== "") leaderboardMessageContent.textContent = message;

  leaderboardStatisticsArr.map((stat) =>
    leaderboardStatistics.appendChild(stat)
  );

  leaderboardMessage.appendChild(leaderboardMessageIcon);
  leaderboardMessage.appendChild(leaderboardMessageContent);

  if (message === "") leaderboardMessage.style.display = "none";

  leaderboardProfile.appendChild(leaderboardProfileImg);
  leaderboardProfile.appendChild(leaderboardUsername);

  leaderboardInfo.appendChild(leaderboardProfile);
  leaderboardInfo.appendChild(leaderboardMessage);
  leaderboardInfo.appendChild(leaderboardStatistics);

  recordTrophy.appendChild(trophy);
  recordTrophy.appendChild(playerPos);

  leaderboardRecord.appendChild(recordTrophy);
  leaderboardRecord.appendChild(leaderboardInfo);

  console.log(leaderboardRecord);

  leaderboardProfileImg.src = profile_src;

  leaderboardProfileImg.addEventListener("error", () => {
    leaderboardProfileImg.src = GUEST_SRC;
  });

  if (index > 2) {
    const FONT_SIZE = `${20 * 0.65 - index.toString().length}px`;
    playerPos.textContent = index + 1;
    playerPos.style.fontSize = FONT_SIZE;

    console.log(FONT_SIZE, playerPos.style.fontSize);
  }

  switch (index) {
    case 0:
      trophy.src = "./assets/1st-place.png";
      break;
    case 1:
      trophy.src = "./assets/2nd-place.png";
      break;
    case 2:
      trophy.src = "./assets/3rd-place.png";
      break;
    default:
      trophy.src = "./assets/star.png";
      break;
  }

  leaderboardRecord.style = `--record-animation-delay: ${index * 0.1}s`;

  return leaderboardRecord;
};

export let mode = localStorage.getItem("leaderboard-mode") || "all-records";

export let setMode = (payload) => {
  mode = payload;
};

export const handleFetchRecords = ({ from, to = 50 }) => {
  // TODO: fetch some records from the API and store them into topPlayers[] array
  // fetching records from the API...

  // map through the records and store them in the leaderboard
  for (let i = from; i < to; i++) {
    if (i == topPlayers.length) break;

    const recordElem = handleCreateElement(i, topPlayers[i]);

    leaderboardTop.appendChild(recordElem);
  }
};

export const calculatePos = () => {
  // TODO: fetch the position of the player from the API using endpoint '/api/user/get-pos'
};

export const sharePos = (e) => {
  // TODO: add position to the DOM and a table, and then do PATCH request to the API (this will be form submit function)
  e.preventDefault();
};
